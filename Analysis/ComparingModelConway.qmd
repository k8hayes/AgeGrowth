---
title: "Comparing Model and Conway"
format: html
---

# Set up

## packages

```{r load packages}
#| warning: false
library(tidyverse)
library(cowplot)
library(kableExtra)
theme_set(theme_cowplot())
```

## load model height

```{r}
<<<<<<< HEAD
ModelMoose <- read.csv("data/model output/Moose.csv")
ModelNoMoose <- read.csv("data/model output/NoMoose.csv")

Model <- full_join(ModelMoose, ModelNoMoose)
=======
ModelNoMoose <- read.csv("data/model output/NoMoose.csv")
ModelMoose <- read.csv("data/model output/Moose.csv")

Model <- full_join(ModelNoMoose, ModelMoose)

ModelAV <- Model %>%
 rename(Height = height, DBH = dbh, Basal = basal) %>%
  pivot_longer(cols = c(Height, DBH, Basal),
              names_to = "Variable",
               values_to = "mean") %>%
 select(TSF, species, Scenario, Variable, mean)

ModelSD <- Model %>%
 rename(Height = height_sd, DBH = dbh_sd, Basal = basal_sd) %>%
 pivot_longer(cols = c(Height, DBH, Basal),
              names_to = "Variable",
               values_to = "sd") %>%
 select(TSF, species, Scenario, Variable, sd)

Model <- left_join(ModelAV, ModelSD)     

rm(ModelNoMoose, ModelMoose, ModelSD, ModelAV)
>>>>>>> 2b15cb8159ec54b72351a0977f7b53b4186f66f2

Model <- Model %>%
mutate(Data = "Model",
       high = mean + sd,
       low = mean - sd,
       Scenario = ifelse(Scenario == "Control", "Browsing", "No Browsing")) 

rm(ModelMoose, ModelNoMoose)

kable(head(Model))
```

# Conway

```{r}
Data <- full_join(conwaySite, Model)

```

# Plot Height

## birch

<<<<<<< HEAD
```{r Conway loading}
conwayIndividRaw <- read.csv("data/Exclosure_Final.csv")
=======
```{r}
beneMod <- Model %>%
  filter(species == "Bene")
>>>>>>> 2b15cb8159ec54b72351a0977f7b53b4186f66f2

beneCon <- conwayHeightSite %>%
  filter(species == "Bene")


ggplot(beneMod) +
    geom_line(aes(x = TSF, y = height, color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = height - height_sd, 
                    ymax = height + height_sd, fill = Scenario), 
                alpha = 0.3) +
  geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)", y = "Av. Height (m)",
         title ="Birch") + xlim(c(0,50)) + 
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) +
  geom_point(data = beneCon, aes(x = TSF, y = mean, 
                                 col = Scenario,
                                 shape = Scenario),
             alpha = 0.4) +
  geom_errorbar(data = beneCon, 
                aes(x = TSF, ymin = low, ymax = high, 
                    col = Scenario),
                position = position_dodge(0.75),
                alpha = 0.5) + 
  ylim(c(-2.5, 15))
```

<<<<<<< HEAD
## height
```{r}
#| warning: false
#| label: conway Height
conwayHeight <- conwayIndividRaw %>%
  select(Site, Treatment, Species, IndTag, Height2013, Height2014,
         Height2015, Height2017) %>%
  mutate(Height2014 = as.numeric(Height2014), # omit NAs
         Height2015 = as.numeric(Height2015),
         Height2017 = as.numeric(Height2017)) %>%
  pivot_longer(cols = c(Height2013, Height2015, 
                        Height2014, Height2017),
               names_to = "Year", values_to = "Height") %>%
  mutate(Year = ifelse(Year == "Height2014", 2014,
                       ifelse(Year == "Height2015", 2015,
                              ifelse(Year == "Height2013", 2013,
                                     ifelse(Year == "Height2017",
                                            2017, NA))))) %>%
  mutate(TSF = Year - 2005) %>% # calculate TSF
  mutate(Height = Height / 100) %>% # transform height from 
  mutate(Scenario = ifelse(Treatment == "Control", 
                            "Browsing", "No Browsing")) %>%
  ungroup() %>%
  drop_na(Height) %>%
  select(!c(IndTag, Year))

summary(conwayHeight)

kable(head(conwayHeight))

# rename species to match
conwayHeight <- conwayHeight %>%
  mutate(species = ifelse(Species == "aspen", "Potr",
                       ifelse(Species == "birch", "Bene",
                              "Pima")))
```

## basal
```{r}
#| warning: false
#| label: conway Basal
conwayBasal <- conwayIndividRaw %>%
  select(Site, Treatment, Species, IndTag, 
         Basal2013, Basal2014,
         Basal2015, Basal2017) %>%
  mutate(Basal2014 = as.numeric(Basal2014), # omit NAs
         Basal2015 = as.numeric(Basal2015),
         Basal2017 = as.numeric(Basal2017)) %>%
  pivot_longer(cols = c(Basal2013, Basal2015, 
                        Basal2014, Basal2017),
               names_to = "Year", values_to = "Basal") %>%
  mutate(Year = ifelse(Year == "Basal2014", 2014,
                       ifelse(Year == "Basal2015", 2015,
                              ifelse(Year == "Basal2013", 2013,
                                     ifelse(Year == "Basal2017",
                                            2017, NA))))) %>%
  mutate(TSF = Year - 2005) %>% # calculate TSF
  mutate(Scenario = ifelse(Treatment == "Control", 
                            "Browsing", "No Browsing")) %>%
  ungroup() %>%
  drop_na(Basal) %>%
  select(!c(IndTag, Year))

summary(conwayBasal)

kable(head(conwayBasal))

# rename species to match
conwayBasal <- conwayBasal %>%
  mutate(species = ifelse(Species == "aspen", "Potr",
                       ifelse(Species == "birch", "Bene",
                              "Pima")))
```

## DBH
```{r}
#| warning: false
#| label: conway DBH
conwayDBH <- conwayIndividRaw %>%
  select(Site, Treatment, Species, IndTag, 
         DBH2013, DBH2014,
         DBH2015, DBH2017) %>%
  mutate(DBH2014 = as.numeric(DBH2014), # omit NAs
                                          
         DBH2015 = as.numeric(DBH2015),
         DBH2017 = as.numeric(DBH2017)) %>%
  pivot_longer(cols = c(DBH2013, DBH2015, 
                        DBH2014, DBH2017),
               names_to = "Year", values_to = "DBH") %>%
  mutate(Year = ifelse(Year == "DBH2014", 2014,
                       ifelse(Year == "DBH2015", 2015,
                              ifelse(Year == "DBH2013", 2013,
                                     ifelse(Year == "DBH2017",
                                            2017, NA))))) %>%
  mutate(TSF = Year - 2005) %>% # calculate TSF
  mutate(Scenario = ifelse(Treatment == "Control", 
                            "Browsing", "No Browsing")) %>%
  ungroup() %>%
  drop_na(DBH) %>%
  select(!c(IndTag, Year))

summary(conwayDBH)

kable(head(conwayDBH))

# rename species to match
conwayDBH <- conwayDBH %>%
  mutate(species = ifelse(Species == "aspen", "Potr",
                       ifelse(Species == "birch", "Bene",
                              "Pima")))
```

```{r conway site avs}
conwayHeightSite <- conwayHeight %>%
  group_by(Scenario, TSF, Site, species) %>%
  summarise(height = mean(Height),
            sd = sd(Height, na.rm = TRUE)) %>%
  mutate(height = round(height, 2),
         low = sd - height,
         high = sd + height) %>%
  mutate(Data = "Field")

summary(conwayHeightSite)
=======
## aspen

```{r}
potrMod <- ModHeight %>%
  filter(species == "Potr")

potrCon <- conwayHeightSite %>%
  filter(species == "Potr")

potrConSd <- potrCon %>%
  group_by(Scenario, TSF) %>%
  summarise(mean = mean(height),
            sd = sd(height, na.rm = TRUE)) %>%
  mutate(low = mean - sd,
         high = mean + sd)


ggplot(potrMod) +
    geom_line(aes(x = TSF, y = height, color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), 
                alpha = 0.3) +
  geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)", y = "Av. Height (m)",
         title ="Aspen") + xlim(c(0,50)) + 
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) +
  geom_point(data = potrCon, aes(x = TSF, y = height, 
                                 col = Scenario,
                                 shape = Scenario),
             alpha = 0.4) +
  geom_errorbar(data = potrCon, 
                aes(x = TSF, ymin = low, ymax = high, 
                    col = Scenario),
                position = position_dodge(0.75),
                alpha = 0.5) + 
  ylim(c(-2.5, 15))
```

## spruce

```{r spruce plot}
pimaMod <- ModHeight %>%
  filter(species == "Pima")

pimaCon <- conwayHeightSite %>%
  filter(species == "Pima")

pimaConSd <- pimaCon %>%
  group_by(Scenario, TSF) %>%
  summarise(mean = mean(height),
            sd = sd(height, na.rm = TRUE)) %>%
  mutate(low = mean - sd,
         high = mean + sd)

ggplot(pimaMod) +
    geom_line(aes(x = TSF, y = height, color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), 
                alpha = 0.3) +
  geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)", y = "Av. Height (m)",
         title = "Black Spruce") + xlim(c(0,50)) + 
  ylim(c(-2.5, 10)) +
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) +
  geom_point(data = beneCon, aes(x = TSF, y = height, 
                                 col = Scenario,
                                 shape = Scenario),
             alpha = 0.4) +
  geom_errorbar(data = pimaConSd, 
                aes(x = TSF, ymin = low, ymax = high, 
                    col = Scenario),
                position = position_dodge(0.75),
                alpha = 0.5)

```

## white spruce

```{r}
ModHeight %>%
  filter(species == "Pigl") %>%
  ggplot() +
    geom_line(aes(x = TSF, y = height, 
color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), alpha = 0.3)+ geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)", y = "Av. Height (m)",
         title = "White Spruce") + xlim(c(0,50)) +
  ylim(c(-2.5,10)) +   
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) 

```

# Plot DBH

## birch

```{r}
beneMod <- Model %>%
  filter(Variable == "DBH") %>%
  filter(species == "Bene")

beneCon <- conwayDBHSite %>%
  filter(species == "Bene")

ggplot(beneMod) +
    geom_line(aes(x = TSF, y = mean, color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), 
                alpha = 0.3) +
  geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)", y = "Av DBH",
         title ="Birch") + xlim(c(0,50)) + 
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) +
  geom_point(data = beneCon, aes(x = TSF, y = mean, 
                                 col = Scenario,
                                 shape = Scenario),
             alpha = 0.4) +
  geom_errorbar(data = beneCon, 
                aes(x = TSF, ymin = low, ymax = high, 
                    col = Scenario),
                position = position_dodge(0.75),
                alpha = 0.5) 
```

## aspen

```{r}
potrMod <- Model %>%
filter(Variable == "DBH") %>%
  filter(species == "Potr")

potrCon <- conwayHeightSite %>%
  filter(species == "Potr")

ggplot(potrMod) +
    geom_line(aes(x = TSF, y = mean, color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), 
                alpha = 0.3) +
  geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)", y = "Av. DBH",
         title ="Aspen") + xlim(c(0,50)) + 
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) +
  geom_point(data = potrCon, aes(x = TSF, y = mean, 
                                 col = Scenario,
                                 shape = Scenario),
             alpha = 0.4) +
  geom_errorbar(data = potrCon, 
                aes(x = TSF, ymin = low, ymax = high, 
                    col = Scenario),
                position = position_dodge(0.75),
                alpha = 0.5)
```

## spruce

```{r spruce plot}
pimaMod <- Model %>%
filter(Variable == "DBH") %>%
  filter(species == "Pima")

pimaCon <- conwayHeightSite %>%
  filter(species == "Pima")

ggplot(pimaMod) +
    geom_line(aes(x = TSF, y = mean, color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), 
                alpha = 0.3) +
  geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)", y = "Av. DBH",
         title = "Black Spruce") + xlim(c(0,50)) + 
  ylim(c(-2.5, 10)) +
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) +
  geom_point(data = pimaCon, aes(x = TSF, y = mean, 
                                 col = Scenario,
                                 shape = Scenario),
             alpha = 0.4) +
  geom_errorbar(data = pimaCon, 
                aes(x = TSF, ymin = low, ymax = high, 
                    col = Scenario),
                position = position_dodge(0.75),
                alpha = 0.5)

```

## white spruce

```{r}
Model %>%
filter(Variable == "DBH") %>%
  filter(species == "Pigl") %>%
  ggplot() +
    geom_line(aes(x = TSF, y = mean, 
color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), alpha = 0.3)+ geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)", y = "Av. Height (m)",
         title = "White Spruce") + xlim(c(0,50)) +
  ylim(c(-2.5,10)) +   
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) 

```

```{r}
bene <- ggplot(beneMod) +
    geom_line(aes(x = TSF, y = mean,
                  color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, 
                    fill = Scenario), 
                alpha = 0.3) +
  geom_hline(yintercept = 0,
             linetype = "dashed") + 
    labs(x = "Time since fire (years)",
         y = "Av. DBH",
         title ="Birch") + xlim(c(0,50)) + 
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) +
  geom_point(data = beneCon, aes(x = TSF, y = mean, 
                                 col = Scenario,
                                 shape = Scenario),
             alpha = 0.4, size = 2) +
  geom_errorbar(data = beneCon, 
                aes(x = TSF, ymin = low, ymax = high, 
                    col = Scenario),
                position = position_dodge(0.75),
                alpha = 0.5) 
  theme(legend.position = "none",
        title = element_text(size = 25),
        axis.title = element_text(size = 20),
        axis.text.y = element_text(size = 15),
        axis.text.x = element_text(size = 15))

potr <- ggplot(potrMod) +
    geom_line(aes(x = TSF, y = mean, color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), 
                alpha = 0.3) +
  geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)",
         y = "Av. DBH",
         title ="Aspen") + xlim(c(0,50)) + 
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) +
  geom_point(data = potrCon, 
             aes(x = TSF, y = mean,
                 col = Scenario,
                 shape = Scenario),
             alpha = 0.4, size = 2) +
  geom_errorbar(data = potrConSd, 
                aes(x = TSF, 
                    ymin = low, ymax = high, 
                    col = Scenario),
                position = position_dodge(0.75),
                alpha = 0.5) + 
  ylim(c(-2.5, 15)) + 
  theme(legend.position = "none",
        title = element_text(size = 25),
        axis.title = element_text(size = 20),
        axis.text.y = element_text(size = 15),
        axis.text.x = element_text(size = 15))
bene

pima <- ggplot(pimaMod) +
    geom_line(aes(x = TSF, y = height, color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), 
                alpha = 0.3) +
  geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)", y = "Av. Height (m)",
         title = "Black Spruce") + xlim(c(0,50)) + 
  ylim(c(-2.5, 10)) +
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) +
  geom_point(data = pimaCon, aes(x = TSF, y = mean, 
                                 col = Scenario,
                                 shape = Scenario),
             alpha = 0.4, size = 2) +
  geom_errorbar(data = pimaCon, 
                aes(x = TSF, ymin = low, ymax = high, 
                    col = Scenario),
                position = position_dodge(0.75),
                alpha = 0.5) + theme(legend.position = "none",
        title = element_text(size = 25),
        axis.title = element_text(size = 20),
        axis.text.y = element_text(size = 15),
        axis.text.x = element_text(size = 15))

pigl <- ModHeight %>%
  filter(species == "Pigl") %>%
  ggplot() +
    geom_line(aes(x = TSF, y = height, 
color = Scenario)) +
    geom_ribbon(aes(x = TSF, ymin = low, 
                    ymax = high, fill = Scenario), alpha = 0.3)+ geom_hline(yintercept = 0, linetype = "dashed") + 
    labs(x = "Time since fire (years)",
         y = "Av. Height (m)",
         title = "White Spruce") + xlim(c(0,50)) +
  ylim(c(-2.5,10)) +   
  scale_color_manual(values = c("#a6611a", "#018571")) + 
  scale_fill_manual(values = c("#a6611a", "#018571")) + 
  theme(legend.position = "none",
        title = element_text(size = 25),
        axis.title = element_text(size = 20),
        axis.text.y = element_text(size = 15),
        axis.text.x = element_text(size = 15))

ggsave2(plot = bene,
        filename = "AgeGrowth_Birch.png",
        path = "/Users/katherinehayes/Google Drive/Projects/NSF Postdoc/Manuscripts/MooseHare/figures/",
        width = 6, height = 5, units = "in")

ggsave2(plot = potr,
        filename = "AgeGrowth_Potr.png",
        path = "/Users/katherinehayes/Google Drive/Projects/NSF Postdoc/Manuscripts/MooseHare/figures/",
        width = 6, height = 5, units = "in")
ggsave2(plot = pima,
        filename = "AgeGrowth_Pima.png",
        path = "/Users/katherinehayes/Google Drive/Projects/NSF Postdoc/Manuscripts/MooseHare/figures/",
        width = 6, height = 5, units = "in")

ggsave2(plot = pigl,
        filename = "AgeGrowth_Pigl.png",
        path = "/Users/katherinehayes/Google Drive/Projects/NSF Postdoc/Manuscripts/MooseHare/figures/",
        width = 6, height = 5, units = "in")
>>>>>>> 2b15cb8159ec54b72351a0977f7b53b4186f66f2
```