---
title: "Comparing Model and Conway"
format: html
---

# Set up

## packages

```{r load packages}
#| warning: false
library(tidyverse)
library(cowplot)
library(kableExtra)
theme_set(theme_cowplot())
```

## load model height

```{r}
Model <- read.csv("data/output/height.csv")

Model <- Model %>%
  mutate(Data = "Model")

kable(head(Model))
```

# Conway

## process conway

```{r Conway loading}
conwayIndividRaw <- read.csv("data/benchmarking/stand/Conway/Conway_Exclosure.csv")

colnames(conwayIndividRaw)

summary(conwayIndividRaw)

kable(head(conwayIndividRaw))
```

```{r Conway cleaning}
#| warning: false
conwayHeight <- conwayIndividRaw %>%
  select(Site, Treatment, Species, IndTag, Height2013, Height2014,
         Height2015, Height2017) %>%
  mutate(Height2014 = as.numeric(Height2014), # omit NAs
         Height2015 = as.numeric(Height2015),
         Height2017 = as.numeric(Height2017)) %>%
  pivot_longer(cols = c(Height2013, Height2015, 
                        Height2014, Height2017),
               names_to = "Year", values_to = "Height") %>%
  mutate(Year = ifelse(Year == "Height2014", 2014,
                       ifelse(Year == "Height2015", 2015,
                              ifelse(Year == "Height2013", 2013,
                                     ifelse(Year == "Height2017",
                                            2017, NA))))) %>%
  mutate(TSF = Year - 2005) %>% # calculate TSF
  mutate(Height = Height / 100) %>% # transform height from 
  mutate(Scenario = ifelse(Treatment == "Control", 
                            "Browsing", "No Browsing")) %>%
  ungroup() %>%
  drop_na(Height) %>%
  select(!c(IndTag, Year))

summary(conwayHeight)

kable(head(conwayHeight))

# rename species to match
conwayHeight <- conwayHeight %>%
  mutate(species = ifelse(Species == "aspen", "Potr",
                       ifelse(Species == "birch", "Bene",
                              "Pima")))
```

```{r conway site avs}
conwayHeightSite <- conwayHeight %>%
  group_by(Scenario, TSF, Site, species) %>%
  summarise(height = mean(Height),
            sd = sd(Height, na.rm = TRUE)) %>%
  mutate(height = round(height, 2),
         low = sd - height,
         high = sd + height) %>%
  mutate(Data = "Field")

summary(conwayHeightSite)
```